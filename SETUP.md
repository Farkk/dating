# Инструкция по запуску проекта Dating Site

Эта инструкция поможет вам настроить и запустить проект Dating Site на локальном компьютере с macOS.

## Содержание
1. [Требования](#требования)
2. [Установка PostgreSQL](#установка-postgresql)
3. [Настройка базы данных](#настройка-базы-данных)
4. [Запуск проекта](#запуск-проекта)
5. [Доступ к админ-панели](#доступ-к-админ-панели)
6. [Возможные проблемы](#возможные-проблемы)

---

## Требования

Перед началом убедитесь, что у вас установлено:
- **macOS** (10.13 или новее)
- **PHP 7.4 или новее** (обычно уже установлен на macOS)
- **PostgreSQL 12 или новее**

### Проверка версии PHP

Откройте терминал и выполните команду:
```bash
php -v
```

Вы должны увидеть версию PHP 7.4 или выше.

---

## Установка PostgreSQL

У вас есть два основных варианта установки PostgreSQL на macOS:

### Вариант 1: DBngin (рекомендуется для начинающих)

**DBngin** — это простое приложение с графическим интерфейсом для управления локальными базами данных.

#### Установка DBngin:

1. Скачайте DBngin с официального сайта: [https://dbngin.com](https://dbngin.com)
2. Откройте скачанный `.dmg` файл
3. Перетащите DBngin в папку Applications
4. Запустите DBngin из папки Applications

#### Настройка PostgreSQL в DBngin:

1. Откройте DBngin
2. Нажмите кнопку **"+"** (New Service) в левом нижнем углу
3. Выберите **PostgreSQL**
4. Укажите параметры:
   - **Version**: выберите последнюю доступную версию (например, PostgreSQL 16)
   - **Port**: оставьте 5432
   - **Data Directory**: можно оставить по умолчанию
5. Нажмите **Create**
6. После создания нажмите кнопку **Start** чтобы запустить сервер PostgreSQL

#### Создание базы данных через DBngin:

1. В списке сервисов нажмите на ваш PostgreSQL сервер
2. Внизу вы увидите кнопку **"psql"** - нажмите её (откроется терминал)
3. В терминале выполните команду:
```sql
CREATE DATABASE dating_site;
```
4. Закройте терминал (введите `\q` и нажмите Enter)

---

### Вариант 2: Postgres.app (альтернатива)

**Postgres.app** — популярное приложение для macOS, которое устанавливает и запускает PostgreSQL.

#### Установка Postgres.app:

1. Скачайте с официального сайта: [https://postgresapp.com](https://postgresapp.com)
2. Откройте скачанный `.dmg` файл
3. Перетащите Postgres в папку Applications
4. Запустите Postgres.app
5. При первом запуске нажмите **Initialize** для создания нового сервера

#### Создание базы данных через Postgres.app:

1. Откройте Postgres.app
2. В окне приложения вы увидите список серверов
3. Двойным кликом откройте сервер (откроется терминал с psql)
4. В терминале выполните:
```sql
CREATE DATABASE dating_site;
```
5. Проверьте, что база создана: `\l` (должна появиться в списке)
6. Закройте терминал: `\q`

---

### Вариант 3: Установка через Homebrew (для опытных пользователей)

```bash
# Установка PostgreSQL
brew install postgresql@16

# Запуск PostgreSQL
brew services start postgresql@16

# Создание базы данных
createdb dating_site
```

---

## Настройка базы данных

После того, как PostgreSQL запущен и база данных `dating_site` создана, необходимо инициализировать схему базы данных.

### Способ 1: Через терминал (рекомендуется)

1. Откройте терминал
2. Перейдите в папку проекта:
```bash
cd /Users/pavel/my-projects/dating-site
```

3. Выполните скрипт инициализации:
```bash
psql -U postgres -d dating_site -f config/init_db.sql
```

Если вы используете DBngin или Postgres.app, имя пользователя по умолчанию - ваше имя пользователя macOS. В этом случае команда будет:
```bash
psql -d dating_site -f config/init_db.sql
```

### Способ 2: Через графический клиент

Вы также можете использовать графические клиенты PostgreSQL, такие как:
- **pgAdmin** (скачать с [pgadmin.org](https://www.pgadmin.org/))
- **DBeaver** (скачать с [dbeaver.io](https://dbeaver.io/))
- **Postico** (скачать с [eggerapps.at/postico](https://eggerapps.at/postico/))

В любом из этих клиентов:
1. Подключитесь к серверу PostgreSQL (localhost:5432)
2. Откройте базу данных `dating_site`
3. Откройте файл `config/init_db.sql`
4. Выполните SQL-скрипт

### Что делает скрипт init_db.sql?

Скрипт создаёт все необходимые таблицы:
- `users` - пользователи сайта
- `user_photos` - фотографии пользователей
- `meetings` - встречи между пользователями
- `messages` - сообщения
- `likes` - лайки пользователей
- `meeting_reviews` - отзывы о встречах
- `user_interests` - интересы пользователей
- `admins` - администраторы системы

А также добавляет тестовые данные:
- 7 пользователей с различными профилями
- 6 встреч (с разными статусами)
- 8 отзывов о встречах
- 1 администратор (логин: admin, пароль: admin123)

---

## Настройка подключения к базе данных

Если вы используете другие параметры подключения (не стандартные), отредактируйте файл `config/db.php`:

```php
$host = 'localhost';      // Хост базы данных
$port = '5432';           // Порт PostgreSQL
$dbname = 'dating_site';  // Имя базы данных
$user = 'postgres';       // Имя пользователя (замените на своё)
$password = '123';        // Пароль (замените на свой)
```

**Важно:** Для DBngin и Postgres.app часто пароль не требуется, просто оставьте пустую строку:
```php
$password = '';
```

---

## Запуск проекта

После настройки базы данных можно запустить проект.

### Запуск через встроенный сервер PHP

1. Откройте терминал
2. Перейдите в папку проекта:
```bash
cd /Users/pavel/my-projects/dating-site
```

3. Запустите встроенный сервер PHP:
```bash
php -S localhost:8000
```

4. Откройте браузер и перейдите по адресу:
```
http://localhost:8000
```

Вы должны увидеть главную страницу Dating Site с тремя разделами:
- Поиск
- Профиль пользователя
- Рейтинг

### Запуск через Apache (опционально)

Если у вас установлен и настроен Apache:

1. Скопируйте папку проекта в папку веб-сервера (обычно `/Library/WebServer/Documents/`)
2. Откройте в браузере: `http://localhost/dating-site/`

---

## Доступ к админ-панели

Админ-панель позволяет управлять всеми аспектами сайта: пользователями, встречами, отзывами.

### Вход в админ-панель

1. Запустите проект (см. выше)
2. В браузере перейдите по адресу:
```
http://localhost:8000/admin/login.php
```

3. Введите учетные данные администратора:
   - **Логин**: `admin`
   - **Пароль**: `admin123`

4. После успешного входа вы попадете на главную панель управления

### Возможности админ-панели

После авторизации вы получите доступ к следующим разделам:

#### 1. Главная страница (Дашборд)
- Статистика: общее количество пользователей, встреч, лайков, отзывов
- Последние зарегистрированные пользователи
- Ближайшие встречи

#### 2. Управление пользователями (`/admin/users.php`)
- Просмотр всех пользователей
- Фильтрация по полу, городу, статусу
- Поиск по имени, email, username
- Массовые операции: активировать, деактивировать, удалить
- Редактирование профиля пользователя
- Добавление нового пользователя

#### 3. Управление встречами (`/admin/meetings.php`)
- Просмотр всех встреч
- Фильтрация по статусу (ожидает, подтверждена, завершена, отменена)
- Изменение статуса встречи
- Удаление встреч

#### 4. Управление отзывами (`/admin/reviews.php`)
- Просмотр всех отзывов
- Статистика по рейтингам
- Фильтрация по рейтингу
- Удаление неподобающих отзывов (с автоматическим пересчетом рейтинга пользователя)

---

## Структура проекта

```
dating-site/
├── admin/                  # Админ-панель
│   ├── css/
│   │   └── admin.css      # Стили админки
│   ├── auth.php           # Хелпер авторизации
│   ├── login.php          # Страница входа
│   ├── logout.php         # Выход из системы
│   ├── index.php          # Главная страница админки
│   ├── users.php          # Управление пользователями
│   ├── user_edit.php      # Редактирование пользователя
│   ├── meetings.php       # Управление встречами
│   └── reviews.php        # Управление отзывами
├── api/                   # API endpoints
│   └── actions.php        # JSON API для лайков, встреч
├── config/                # Конфигурация
│   ├── db.php            # Подключение к базе данных
│   └── init_db.sql       # Инициализация базы данных
├── find/                  # Раздел поиска
│   ├── index.html        # Статическая версия
│   ├── index.php         # Динамическая версия
│   ├── css/              # Стили
│   └── images/           # Изображения
├── rating/                # Раздел рейтинга
│   ├── index.html
│   ├── css/
│   └── images/
├── user/                  # Раздел профиля
│   ├── index.html
│   ├── css/
│   └── images/
├── index.html             # Главная страница
├── .htaccess             # Настройки Apache
├── CLAUDE.md             # Документация для Claude Code
└── SETUP.md              # Эта инструкция
```

---

## Возможные проблемы

### Проблема: "Connection refused" или не удается подключиться к базе данных

**Решение:**
1. Убедитесь, что PostgreSQL запущен:
   - Для DBngin: проверьте, что статус сервера "Running" (зеленый индикатор)
   - Для Postgres.app: проверьте, что приложение запущено
   - Для Homebrew: `brew services list` (должно быть "started")

2. Проверьте параметры подключения в `config/db.php`

3. Попробуйте подключиться через терминал:
```bash
psql -h localhost -p 5432 -U postgres -d dating_site
```

### Проблема: "FATAL: database "dating_site" does not exist"

**Решение:**
Создайте базу данных заново:
```bash
psql -U postgres -c "CREATE DATABASE dating_site;"
```

### Проблема: "FATAL: role "postgres" does not exist"

**Решение:**
Для DBngin и Postgres.app используйте имя вашего пользователя macOS вместо "postgres":
```bash
psql -d dating_site -f config/init_db.sql
```

И измените в `config/db.php`:
```php
$user = 'ваше_имя_пользователя';  // вместо 'postgres'
$password = '';                    // обычно пароль не требуется
```

### Проблема: Не открывается страница в браузере

**Решение:**
1. Убедитесь, что PHP-сервер запущен (должна быть строка "PHP Development Server started...")
2. Проверьте правильность URL: `http://localhost:8000` (именно 8000, не 8080)
3. Если порт 8000 занят, используйте другой:
```bash
php -S localhost:8080
```

### Проблема: Ошибки при выполнении init_db.sql

**Решение:**
Если при инициализации появляются ошибки о существующих таблицах, сначала удалите все таблицы:

```sql
DROP TABLE IF EXISTS meeting_reviews CASCADE;
DROP TABLE IF EXISTS user_interests CASCADE;
DROP TABLE IF EXISTS likes CASCADE;
DROP TABLE IF EXISTS messages CASCADE;
DROP TABLE IF EXISTS meetings CASCADE;
DROP TABLE IF EXISTS user_photos CASCADE;
DROP TABLE IF EXISTS users CASCADE;
DROP TABLE IF EXISTS admins CASCADE;
```

Затем снова выполните `config/init_db.sql`.

### Проблема: Не работает админ-панель (редирект на login.php)

**Решение:**
1. Убедитесь, что в PHP включены сессии (обычно включены по умолчанию)
2. Проверьте, что в браузере включены cookies
3. Очистите кэш браузера и cookies
4. Попробуйте использовать режим инкогнито

---

## Полезные команды

### PostgreSQL

```bash
# Вход в psql
psql -d dating_site

# Список всех таблиц
\dt

# Просмотр структуры таблицы
\d users

# Подсчет пользователей
SELECT COUNT(*) FROM users;

# Просмотр всех администраторов
SELECT * FROM admins;

# Выход из psql
\q
```

### PHP

```bash
# Проверка версии PHP
php -v

# Проверка установленных расширений
php -m

# Запуск встроенного сервера
php -S localhost:8000

# Запуск на другом порту
php -S localhost:8080
```

---

## Смена пароля администратора

Если вы хотите изменить пароль администратора:

1. Сгенерируйте хеш нового пароля в PHP:
```bash
php -r "echo password_hash('новый_пароль', PASSWORD_DEFAULT);"
```

2. Скопируйте полученный хеш

3. Обновите пароль в базе данных:
```sql
psql -d dating_site -c "UPDATE admins SET password_hash = 'полученный_хеш' WHERE username = 'admin';"
```

---

## Резервное копирование базы данных

Для создания резервной копии базы данных:

```bash
pg_dump -U postgres dating_site > backup_$(date +%Y%m%d).sql
```

Для восстановления из резервной копии:

```bash
psql -U postgres -d dating_site < backup_20250101.sql
```

---

## Контакты и поддержка

Если у вас возникли проблемы или вопросы:
1. Проверьте раздел [Возможные проблемы](#возможные-проблемы)
2. Убедитесь, что все требования выполнены
3. Проверьте логи ошибок PHP (они выводятся в терминал при работе встроенного сервера)

---

## Дополнительная информация

- **Официальная документация PostgreSQL**: https://www.postgresql.org/docs/
- **Документация PHP**: https://www.php.net/manual/ru/
- **DBngin**: https://dbngin.com
- **Postgres.app**: https://postgresapp.com

Удачи в работе с Dating Site! 💖
